# SimpleAi

A library to train and run Neural Networks on CPU using vectorization and as many optimizations as I can be bothered to implement.

This is most definitely **NOT PRODUCTION READY NOR WILL IT EVER BE**. If you want to actually create and run neural networks, use something like ML.NET, PyTorch or any other reputable AI library.

Was made while watching [Sebastian Lague](https://www.youtube.com/@SebastianLague)'s "[How to Create a Neural Network (and Train it to Identify Doodles)](https://youtu.be/hfMk-kjRv4c)" video and implementing my own optimizations on top of it.

## Performance

The following are **single-layer** inference results:

```

BenchmarkDotNet v0.14.0, Windows 11 (10.0.26100.3194)
Intel Core i5-8250U CPU 1.60GHz (Kaby Lake R), 1 CPU, 8 logical and 4 physical cores
.NET SDK 9.0.200
  [Host]     : .NET 9.0.2 (9.0.225.6610), X64 RyuJIT AVX2
  Job-EUMIWA : .NET 9.0.2 (9.0.225.6610), X64 RyuJIT AVX2

Runtime=.NET 9.0  Arguments=/p:NoWarn=SYSLIB5001  MemoryRandomization=True  
RunStrategy=Throughput  

```
| Method      | Inputs | Neurons | Mean           | Error         | StdDev         | Median         | P95            | Gen0        | Gen1        | Allocated     |
|------------ |------- |-------- |---------------:|--------------:|---------------:|---------------:|---------------:|------------:|------------:|--------------:|
| **FloatInfer**  | **5**      | **5**       |       **7.284 μs** |     **0.4708 μs** |      **1.3882 μs** |       **6.656 μs** |      **10.867 μs** |      **1.3504** |           **-** |       **4.15 KB** |
| DoubleInfer | 5      | 5       |       7.011 μs |     0.2332 μs |      0.6876 μs |       6.815 μs |       8.152 μs |      1.4343 |           - |       4.41 KB |
| **FloatInfer**  | **5**      | **10**      |      **14.085 μs** |     **0.7420 μs** |      **2.1878 μs** |      **13.233 μs** |      **19.902 μs** |      **2.5787** |           **-** |       **7.93 KB** |
| DoubleInfer | 5      | 10      |      13.927 μs |     0.7890 μs |      2.3264 μs |      12.979 μs |      20.525 μs |      2.7618 |           - |       8.48 KB |
| **FloatInfer**  | **5**      | **250**     |     **316.718 μs** |     **5.2533 μs** |      **4.9139 μs** |     **315.103 μs** |     **323.878 μs** |     **61.5234** |           **-** |      **189.8 KB** |
| DoubleInfer | 5      | 250     |     321.075 μs |     9.9319 μs |     29.2844 μs |     315.077 μs |     354.547 μs |     66.4063 |           - |     203.48 KB |
| **FloatInfer**  | **5**      | **5000**    |   **6,647.533 μs** |   **293.9685 μs** |    **866.7728 μs** |   **6,303.663 μs** |   **8,546.111 μs** |   **1234.3750** |           **-** |    **3789.42 KB** |
| DoubleInfer | 5      | 5000    |   6,286.449 μs |    58.9754 μs |     55.1657 μs |   6,276.250 μs |   6,367.662 μs |   1320.3125 |           - |    4062.85 KB |
| **FloatInfer**  | **5**      | **10000**   |  **13,346.932 μs** |   **828.2448 μs** |  **2,442.0987 μs** |  **12,453.557 μs** |  **21,070.668 μs** |   **2468.7500** |           **-** |    **7578.48 KB** |
| DoubleInfer | 5      | 10000   |  13,146.008 μs |   681.0274 μs |  2,008.0247 μs |  12,485.359 μs |  19,331.666 μs |   2640.6250 |           - |    8125.36 KB |
| **FloatInfer**  | **10**     | **5**       |       **7.786 μs** |     **0.4909 μs** |      **1.4476 μs** |       **6.960 μs** |      **11.171 μs** |      **1.4267** |           **-** |       **4.38 KB** |
| DoubleInfer | 10     | 5       |       6.961 μs |     0.0791 μs |      0.0740 μs |       6.948 μs |       7.080 μs |      1.6251 |           - |          5 KB |
| **FloatInfer**  | **10**     | **10**      |      **13.957 μs** |     **0.7478 μs** |      **2.2050 μs** |      **13.081 μs** |      **19.559 μs** |      **2.7313** |           **-** |        **8.4 KB** |
| DoubleInfer | 10     | 10      |      14.525 μs |     0.8116 μs |      2.3931 μs |      13.145 μs |      20.452 μs |      3.1433 |           - |       9.65 KB |
| **FloatInfer**  | **10**     | **250**     |     **342.418 μs** |    **23.0590 μs** |     **67.9899 μs** |     **312.561 μs** |     **529.427 μs** |     **65.4297** |           **-** |     **201.52 KB** |
| DoubleInfer | 10     | 250     |     335.529 μs |    19.7494 μs |     58.2314 μs |     314.377 μs |     467.412 μs |     75.6836 |           - |     232.77 KB |
| **FloatInfer**  | **10**     | **5000**    |   **6,288.879 μs** |    **55.5658 μs** |     **51.9763 μs** |   **6,279.259 μs** |   **6,380.892 μs** |   **1312.5000** |           **-** |    **4023.79 KB** |
| DoubleInfer | 10     | 5000    |   6,451.833 μs |    51.8815 μs |     48.5300 μs |   6,448.830 μs |   6,530.885 μs |   1515.6250 |           - |    4648.79 KB |
| **FloatInfer**  | **10**     | **10000**   |  **16,754.713 μs** | **1,110.0304 μs** |  **3,272.9500 μs** |  **16,226.398 μs** |  **22,770.158 μs** |   **2625.0000** |           **-** |    **8047.23 KB** |
| DoubleInfer | 10     | 10000   |  19,500.695 μs | 1,642.6360 μs |  4,843.3497 μs |  20,005.061 μs |  27,022.051 μs |   3031.2500 |           - |    9297.24 KB |
| **FloatInfer**  | **250**    | **5**       |      **11.717 μs** |     **1.1444 μs** |      **3.3743 μs** |      **11.499 μs** |      **17.834 μs** |      **6.0120** |           **-** |      **18.45 KB** |
| DoubleInfer | 250    | 5       |      13.789 μs |     0.9758 μs |      2.8772 μs |      13.837 μs |      17.593 μs |     10.8032 |           - |      33.13 KB |
| **FloatInfer**  | **250**    | **10**      |      **22.287 μs** |     **1.5185 μs** |      **4.4773 μs** |      **21.735 μs** |      **29.929 μs** |     **11.9019** |           **-** |      **36.52 KB** |
| DoubleInfer | 250    | 10      |      23.867 μs |     1.7572 μs |      5.1811 μs |      22.557 μs |      34.060 μs |     21.4844 |           - |       65.9 KB |
| **FloatInfer**  | **250**    | **250**     |     **482.694 μs** |    **31.9244 μs** |     **94.1299 μs** |     **451.108 μs** |     **689.619 μs** |    **294.9219** |           **-** |     **904.65 KB** |
| DoubleInfer | 250    | 250     |     583.769 μs |    49.4753 μs |    145.8792 μs |     518.295 μs |     834.794 μs |    534.1797 |           - |    1639.02 KB |
| **FloatInfer**  | **250**    | **5000**    |  **10,040.058 μs** |   **583.1319 μs** |  **1,719.3776 μs** |  **10,022.804 μs** |  **12,614.787 μs** |   **5890.6250** |           **-** |   **18086.29 KB** |
| DoubleInfer | 250    | 5000    |   9,900.621 μs |   196.8878 μs |    369.8030 μs |   9,824.395 μs |  10,580.819 μs |  10687.5000 |           - |   32773.79 KB |
| **FloatInfer**  | **250**    | **10000**   |  **15,851.464 μs** |   **296.9913 μs** |    **304.9882 μs** |  **15,807.122 μs** |  **16,421.452 μs** |  **11781.2500** |           **-** |   **36172.24 KB** |
| DoubleInfer | 250    | 10000   |  19,529.389 μs |   214.1257 μs |    200.2933 μs |  19,587.691 μs |  19,768.539 μs |  21375.0000 |           - |   65547.24 KB |
| **FloatInfer**  | **5000**   | **5**       |      **35.054 μs** |     **0.3753 μs** |      **0.3510 μs** |      **35.064 μs** |      **35.664 μs** |     **96.7407** |           **-** |     **296.77 KB** |
| DoubleInfer | 5000   | 5       |      62.861 μs |     1.1997 μs |      1.2321 μs |      62.934 μs |      65.177 μs |    192.2607 |           - |     589.77 KB |
| **FloatInfer**  | **5000**   | **10**      |      **69.755 μs** |     **1.3040 μs** |      **1.2198 μs** |      **69.349 μs** |      **71.507 μs** |    **193.4814** |           **-** |     **593.16 KB** |
| DoubleInfer | 5000   | 10      |     125.902 μs |     2.4790 μs |      4.0031 μs |     124.867 μs |     132.900 μs |    384.5215 |           - |    1179.18 KB |
| **FloatInfer**  | **5000**   | **250**     |   **1,949.950 μs** |    **38.1114 μs** |     **62.6181 μs** |   **1,946.699 μs** |   **2,040.847 μs** |   **4812.5000** |           **-** |   **14820.67 KB** |
| DoubleInfer | 5000   | 250     |   3,683.014 μs |    71.9662 μs |     93.5764 μs |   3,681.704 μs |   3,822.213 μs |   9500.0000 |           - |   29471.06 KB |
| **FloatInfer**  | **5000**   | **5000**    |  **39,049.063 μs** |   **778.1205 μs** |  **1,278.4745 μs** |  **38,629.514 μs** |  **40,968.929 μs** |  **96142.8571** |           **-** |  **296406.63 KB** |
| DoubleInfer | 5000   | 5000    |  71,373.977 μs | 1,397.2069 μs |  2,091.2736 μs |  70,706.075 μs |  75,768.269 μs | 189875.0000 |           - |  589414.46 KB |
| **FloatInfer**  | **5000**   | **10000**   |  **81,681.736 μs** | **3,974.3162 μs** | **11,718.3619 μs** |  **77,817.357 μs** | **103,501.541 μs** | **192285.7143** |           **-** |  **592812.91 KB** |
| DoubleInfer | 5000   | 10000   | 142,785.137 μs | 1,910.3451 μs |  1,786.9380 μs | 142,111.225 μs | 145,453.440 μs | 379500.0000 |   1000.0000 | 1178828.57 KB |
| **FloatInfer**  | **10000**  | **5**       |      **63.599 μs** |     **1.2656 μs** |      **1.9328 μs** |      **63.121 μs** |      **66.548 μs** |    **192.2607** |           **-** |     **589.73 KB** |
| DoubleInfer | 10000  | 5       |     145.255 μs |     3.5678 μs |     10.5197 μs |     139.819 μs |     166.743 μs |    374.2676 |    124.7559 |     1175.7 KB |
| **FloatInfer**  | **10000**  | **10**      |     **146.353 μs** |    **10.7044 μs** |     **31.5620 μs** |     **135.068 μs** |     **215.605 μs** |    **384.5215** |           **-** |     **1179.1 KB** |
| DoubleInfer | 10000  | 10      |     367.500 μs |    28.3857 μs |     83.6960 μs |     328.392 μs |     548.137 μs |    746.5820 |    249.0234 |    2351.05 KB |
| **FloatInfer**  | **10000**  | **250**     |   **3,802.147 μs** |   **169.0425 μs** |    **498.4256 μs** |   **3,585.080 μs** |   **4,845.475 μs** |   **9500.0000** |           **-** |    **29469.1 KB** |
| DoubleInfer | 10000  | 250     |   7,795.404 μs |   101.3280 μs |     94.7823 μs |   7,795.826 μs |   7,936.551 μs |  15156.2500 |   4851.5625 |   58767.93 KB |
| **FloatInfer**  | **10000**  | **5000**    |  **77,352.130 μs** | **6,058.6888 μs** | **17,864.1820 μs** |  **71,737.890 μs** | **124,045.346 μs** | **189800.0000** |           **-** |  **589375.43 KB** |
| DoubleInfer | 10000  | 5000    | 151,426.987 μs | 3,022.9836 μs |  4,616.4156 μs | 149,728.450 μs | 160,429.913 μs | 305750.0000 | 101750.0000 | 1175352.01 KB |
| **FloatInfer**  | **10000**  | **10000**   | **146,367.926 μs** | **2,840.8605 μs** |  **3,888.6023 μs** | **145,691.663 μs** | **148,957.906 μs** | **379500.0000** |           **-** | **1178750.45 KB** |
| DoubleInfer | 10000  | 10000   | 321,754.194 μs | 5,987.4196 μs |  6,148.6391 μs | 320,776.500 μs | 328,936.480 μs | 611000.0000 | 204000.0000 | 2350703.87 KB |
